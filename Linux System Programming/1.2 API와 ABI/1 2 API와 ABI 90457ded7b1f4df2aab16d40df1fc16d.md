# 1.2 API와 ABI

Tags: Ch.1 핵심 개념 소개
Date: 2023년 9월 20일

# 1.2.0 소개

개발자는 당연히 자기가 작성한 프로그램이 항상 잘 작동하길 바란다.

자기가 사용하는 리눅스 배포판에서 잘 동작하는 프로그램이 다른 리눅스 배포판에서도 문제없이 동작해야 안심을 할 수 있다.

시스템 레벨에서 보면 호환성에 영향을 주는 2가지 내용이 있는데, 바로 API(Application Programming Interface)와 ABI(Application Binary Interface)다. 둘 다 서로 다른 컴퓨터 소프트웨어 간의 인터페이스를 정의하고 기술한다.

# 1.2.1 API

- Origin
    
    ![Untitled](1%202%20API%E1%84%8B%E1%85%AA%20ABI%2090457ded7b1f4df2aab16d40df1fc16d/Untitled.png)
    

### 정의

API는 소프트웨어의 소스 코드 레벨에서 서로 인터페이스 하는 방식을 정의한다. 일반적으로 API의 표준 인터페이스는 함수이며, 상위 레벨의 소프트웨어에서 더 하위 레벨의 소프트웨어를 호출 할 수 있다. 예를 들면 화면에 글자를 출력하는 데 필요한 내용을 제공하는 함수의 집합을 API 라고 할 수 있겠다. API 는 그저 인터페이스를 정의하며 그 정의를 실제로 구현한 소프트웨어를 API 구현체 라고 한다.

- *(이게 뭔 소리지 싶어서 싶어서 원서를 찾아봤다.)*
    
    API는 소프트웨어 한조각이 다른 조각과 소스 수준에서 통신하는 인터페이스이다. (우리가 흔히 아는 API로 생각을 하면 된다. API를 모르면 검색!)
    
    이것은 일반적으로 함수들로 구성된 표준 인터페이스 집합을 제공하여 추상화를 제공한다.  한 조각의 소프트웨어(일반적으로 더 높은 수준의 조각이지만 꼭 그렇지 않다.)에서 다른 조각의 소프트웨어(일반적으로 더 낮은 수준의 조각)에서 호출할 수 있는 함수를 제공합니다. 예를 들어, API는 화면에 텍스트를 그리는 개념으로 추상화할 수 있는데, 이를 그리기에 필요한 모든 것을 제공하는 함수(function) 집합을 통해 구현할 수 있다. API는 단순히 인터페이스를 정의할 뿐입니다. 실제로 API를 제공하는 소프트웨어 조각은 API의 구현이라고 알려져 있습니다.
    

### 계약

API를 흔히 계약(contract)이라고 부른다. API는 쌍방 계약이 아니므로 법률적으로 본다면 정확한 비유는 아니다. *(굳이 통신처럼 쌍방이 아니기에 계약이라고 볼 수 없기도 하다는 뜻. 받기도 하며, 보내기 하기에..)*

보통 상위 레벨의 소프트웨어인 API의 사용자는 API와 그 구현에 직접적인 영향을 끼치지 못한다. 그냥 API 자체를 사용하거나 사용하지 않거나 둘 중 하나이다. API는 양쪽 소프트웨어 모두가 API를 준수 할 경우에만 동작하며 소스 코드 수준에서 호환된다.

- *소프트웨어 레벨 수준 ?*
    
    자세한 것은 링크를 통해 알 수 있고, 간략하게는 밑의 사진을 통해 보면 좋을꺼 같다.
    
    [High level software: All you need to know about it!](https://www.cliently.com/blog/high-level-software)
    
    ![Untitled](1%202%20API%E1%84%8B%E1%85%AA%20ABI%2090457ded7b1f4df2aab16d40df1fc16d/Untitled%201.png)
    

API의 구현체와 관계없이 그 API를 따르기만 한다면 성공적으로 컴파일된다.

### 결론

이 책 전반에 걸쳐 3장에서 살펴볼 표준 입출력 라이브러리 같은 다양한 API를 사용할 것이다. 리눅스 시스템 프로그래밍에서 가장 중요한 API는 38쪽 ‘표준’절에서 살펴보겠다.

**→ 결론. 간단히만 알아두자.**

# 1.2.2 ABI

### 정의

ABI → 특정 아키텍처 간에서 동작하는 소프트웨어 간의 바이너리 인터페이스를 정의한다. ABI는 애플리케이션 내에서의 상호 동작, 커널과 애플리케이션, 혹은 애플리케이션과 라이브러리 간의 상호동작에 대해서 정의한다.

API가 소스 코드 수준의 호환성을 보장한다면 ABI는 바이너리의 호환성을 보장하며 이는 오브젝트 코드를 다시 컴파일하는 수고 없이 같은 ABI를 지원하는 시스템이라면 동일한 기능을 수행하도록 보장한다.

### 예시

ABI는 콜링 컨벤션, 바이트 순서, 레지스터 활용, 시스템 콜 실행, 라이브러리 링크, 라이브러리 동작 방식, 바이너리 오브젝트 형식 같은 내용과 관련이 있다. 예를 들어 콜링 컨벤션은 함수가 실행되는 방식, 인자가 함수로 전달되는 방식, 레지스터에 값을 저장하는 방식, 함수를 호출한 측에서 반환값을 가져가는 방식등을 정의한다.

### 방향성

시스템 프로그래머라면 ABI가 있다는 사실을 알아둬야 하지만 모두 외울 필요는 없다. ABI는 컴파일러, 링커 같은 툴체인에 의해서 강제되므로 겉으로 드러나는 일은 거의 없다. 하지만 ABI에 대한 지식이 있으면 프로그램을 좀 더 최적화할 수 있으며, 시스템 프로그래밍의 한 종류인 어셈블리 코드나 툴체인 자체를 개발할 때는 ABI를 꼭 알아야한다.